












           000000   0     0  0000000  0     0  0     0
           0     0  0     0  0        0     0  0     0
           0     0  0     0  0        0   0 0  0     0
           000000    000000  000000   0  0  0  0000000
           0              0  0     0  0 0   0  0     0
           0              0  0     0  0     0  0     0
           0        000000   000000   0     0  0     0






         СС ИИ СС ТТ ЕЕ ММ АА   УУ ПП РР АА ВВ ЛЛ ЕЕ НН ИИ ЯЯ   ББ АА ЗЗ ОО ЙЙ
                     ДД АА НН НН ЫЫ ХХ   РР УУ ББ ИИ НН


                            ВЕРСИЯ 2
           С П Р А В О Ч Н О Е  Р У К О В О Д С Т В О
                    П О   С У Б Д   Р У Б И Н

















                         ММоосскквваа 77//2244//8899















     Эта книга представляет собой справочное руководство по  сис-
     теме  управления базами данных РУБИН.  В нем описывается ис-
     пользование РУБИН в очень сжатом виде.  Для того, чтобы нау-
     читься  использовать  РУБИН,  следует обращаться к документу
     "Учебное введение в РУБИН"

     Справочное руководство по РУБИН подразделяется на 4 части:
       QUEL    описывает команды и возможности, которые использу-
               ются  в  самом  РУБИН. В этой же части описываются
               языки QUEL, EQUEL и MACROS.
       ДЕМОС   описывает программы  РУБИН,  которые  выполняются,
               как команды ДЕМОС.
       FILES   описывает некоторые из важнейших файлов, использу-
               емых РУБИН.
       ERROR   перечисляет все сообщения  об  ошибках,  причинами
               которых  являются сами пользователи, а также неко-
               торые сведения о том, что эти  сообщения  означают
               или что мы думаем, что они означают.

     Каждая статья в этом руководстве  содержит  одну  или  более
     секций:

     ИМЯ
          В этой секции повторяется имя статьи и  указывается  ее
          назначение.

     ФОРМАТ
          В этой секции указывается  форма  команды  (оператора).
          Имеются следующие используемые соглашения:

             Имена выделенные  жирным  шрифтом  используются  для
                    указания резервированных ключевых слов.
             Слова записанные наклонным шрифтом или  подчеркнутые
                    указывают  производные  типы информации, пре-
                    доставляемые пользователям; разрешенные  зна-
                    чения  этих  имен описываются в секции ОПИСА-
                    НИЕ.
             Квадратные скобки [] указывают, что взятый в  скобки
                    элемент  данных  используется  по  выбору (не
                    обязателен).
             Фигурные скобки {} указывают необязательный  элемент
                    данных, который может повторяться.  В некото-
                    рых случаях они указывают простую (неповторя-
                    ющуюся)  группировку; ее использование должно
                    быть ясно из контекста.

          Когда эти соглашения недостаточны для полной специфика-
          ции  допустимого  формата команды, то в секции ОПИСАНИЕ
          определяются более общая  форма  и  допустимые  подмно-
          жества.

     ОПИСАНИЕ
          В этой секции приводится детальное описание  статьи  со
          ссылками  на  производные  имена, используемые в секции
          ФОРМАТ.

     ПРИМЕР
          В этой секции приводятся примеры использования  статьи.
          Большинство этих примеров основываются на следующих от-


                              - 2 -








ВВВВЕЕДДЕЕННИИЕЕ ВВ РРУУББИИНН(())                             ВВВВЕЕДДЕЕННИИЕЕ ВВ РРУУББИИНН(())


          ношениях:

           emp( name,sal,mgr,bdate)
              и
           newemp(name,sal,age)
              и
           parts(pnum, pname, color, weight, qoh)


     ДОПОЛНИТЕЛЬНЫЕ ССЫЛКИ
          В этой секции приводятся имена  статей  в  руководстве,
          которые  близко  связаны с данной статьей или к которым
          производятся ссылки в описании данной статьи.

     ОШИБКИ
          Эта секция указывает известные ошибки  или  опечатки  в
          команде.

     Для того,чтобы начать использовать РУБИН, вам нужно войти  в
     систему  в  качестве  пользователя РУБИН; это делается с по-
     мощью  администратора  РУБИН,  который  введет  вас  в  файл
     ``users'' (см. users(files)).  Чтобы начать пользоваться РУ-
     БИН,  просмотрите  секцию  по  rubin(демос),  Quel(quel),  и
     monitor(quel).






























                              - 1 -








ИИЗЗММЕЕННЕЕННИИЯЯ ВВ РРУУББИИНН 22..1155(())                 ИИЗЗММЕЕННЕЕННИИЯЯ ВВ РРУУББИИНН 22..1155(())



       1.1. Введены новые типы данных:

          date - для хранения дат (см. date(QUEL));
          time - для хранения времени (см. там же);

         Дата хранится в формате длинного целого числа  и  предс-
         тавляет  собой  число  дней, прошедших с 1 января 0 года
         (по новому стилю) до нужной даты. Время хранится в  фор-
         мате длинного целого числа как число секунд.
       1.2. Введены функции преобразования даты и времени в текс-
         товый формат и обратно:

          ascii - преобразование в текст по умолчанию;
          date4 - преобразование из текста в дату по умолчанию;
          time4 - преобразование из текста во время по умолчанию;
          to_date(str,fmt)
          to_time(str,fmt) - преобразования в  дату  и  время  по
         шаблону;
          from_date(d,fmt)
          from_time(d,fmt) - преобразования в  текст  из  даты  и
         времени по шаблону;

       1.3. Введены константы типа дата и время, например:
          '12-Окт-1989'
          '22:10:00'
       1.4. Введены функции, выдающие текущую дату и время:
          sysdate
          systime

         Подробное описание новых возможностей, связанных с датой
         и  временем, можно найти в справочном руководстве по РУ-
         БИН, раздел DDAATTEE((QQUUEELL)).
       2. Введены глобальные  ППЕЕРРЕЕММЕЕННННЫЫЕЕ,  которые  предназначены
         для получения уникальных чисел для записи новых данных в
         базу данных. Введен оператор создания переменной:

          define _и_м_я = _з_н_а_ч_е_н_и_е

         а также три функции:

          i = ser_next("_и_м_я") - получить текущее  значение  пере-
         менной  и  увеличить  ее  на 1 (эквивалентно i = var++ в
         языке Си);

          i = ser_last("_и_м_я_R") - _п_о_л_у_ч_и_т_ь _п_о_в_т_о_р_н_о _п_о_с_л_е_д_н_е_е _з_н_а_-
         _ч_е_н_и_е _п_е_р_е_м_е_н_н_о_й;

          _i = _s_e_r__s_e_t("_и_м_я_R", _з_н_а_ч_е_н_и_е)  -  присвоить  переменной
         указанное значение.

         Подробности описаны в разделе  SERIAL(QUEL)  справочного


                              - 1 -








ИИЗЗММЕЕННЕЕННИИЯЯ ВВ РРУУББИИНН 22..1155(())                 ИИЗЗММЕЕННЕЕННИИЯЯ ВВ РРУУББИИНН 22..1155(())


         руководства по СУБД РУБИН.

       3. В язык EEQQEELL включен ряд  новых  возможностей:  перехват
         печати сообщений об ошибках (для экранных программ); пе-
         рехват системных ошибок (например, попытки открыть несу-
         ществующую базу данных); параметрический оператор "wwhheerree
         ppaarraamm((ppss,,ppvv))"; введены подпрограммы преобразования  даты
         и  времени.  В комплект документации по системе включено
         новое описание: "ППррооггррааммммииррооввааннииее ннаа яяззыыккее EEQQUUEELL".

       4. Изменено соглашение об внешних именах файлов  так,  что
         теперь  в  базе данных сожно создавать отношения с русс-
         кими именами даже на системах, которые  не  поддерживают
         русских  имен  файлов  (например, ОС ULTRIX или UNIX 5.3
         для LABTAM.







































                              - 2 -








ИИЗЗММЕЕННЕЕННИИЯЯ ВВ РРУУББИИНН 22..1144(())                 ИИЗЗММЕЕННЕЕННИИЯЯ ВВ РРУУББИИНН 22..1144(())



     В данном руководстве описана версия СУБД РУБИН 2.10.  Данная
     система активно развивается, и на 10 февраля 1988 года рабо-
     тала версия 2.14 СУБД РУБИН.  Ниже перечислены основные  от-
     личия этой версии от описанной в инструкциях.

     Список отличий версии 2.14 от 2.13:

       1. Введены новые параметры  при  модификации  отношений  в
         структуру  хранения  hash.  Вместо  указания "minpages="
         можно (и рекомендуется) просто указывать "tuples=_n", где
         _n  -  число  записей, для которого нужно зарезервировать
         место. В отличие от прошлых версий, те страницы  отноше-
         ния,  которые не содержат информации, на диск не записы-
         ваются.  Добавлен также описатель "ufactor=_n", где  _n  -
         среднее  число одинаковых ключей в отношении. Этот пара-
         метр используется для оптимизации размещения  записей  в
         отношении  и его правильное использование позволяет нес-
         колько ускорить доступ и значительно уменьшить  занимае-
         мую память в случае короткого целочисленного ключа (типа
         i2 или i4).  Значение ufactor=0 означает "старый"  вари-
         ант функции хэширования.

       2. При модификации в hash система не записывает  физически
         на  диск  те страницы отношения, которые не содержат ин-
         формации (кроме последней страницы отношения). Это  поз-
         воляет  эффективно работать с растущими отношениями, мо-
         дифицируя их в hash  по  уникальному  ключу  и  указывая
         "ufactor=1,  tuples=_n",  где  _n  - максимально возможное
         число записей в отношении много  большее  текущего.  При
         этом  будет  создан  файл с "дырками" (то есть с пустыми
         блоками), которые будут использоваться по мере  накопле-
         ния информации.

       3. Исправлена работа с записями больше 512 байтов.

       4. Максимальная длина записи равна 1010 байт  (ранее  было
         506);

       5. Исправлены ошибки в системе блокировки при параллельной
         работе, в особенности для версии СМ-1420.

       6. При работе с базой, созданной с ключом  "-q",  к  имени
         таблицы процессов добавляется "-Q" и при работе на 16-ти
         разрядных ЭВМ не вызывается "QRYMOD" (экономится память,
         время вызова и системные таблицы).

         Список отличий версии 2.13 от версии 2.10 (подробнее см.
         ~rubin/source/HISTORY):

       1. Исправлен ряд ошибок в EQUEL и в самой СУБД.



                              - 1 -








ИИЗЗММЕЕННЕЕННИИЯЯ ВВ РРУУББИИНН 22..1144(())                 ИИЗЗММЕЕННЕЕННИИЯЯ ВВ РРУУББИИНН 22..1144(())


       2. Улучшена обработка сигнала прерывания в QUEL,  в  част-
         ности,  теперь  операция modify прерывается нормально, а
         прерывание операций CREATE, DESTROY не приводит к  зави-
         санию нестертых атрибутов в системных описаниях.

       3. Добавлено правило умолчаний для range переменных:  если
         переменная  не определена, и существует отношение с име-
         нем, равным имени этой переменной, то переменная  связы-
         вается с этим отношением по умолчанию. Поэтому вместо:

              range of e is salary
              retrieve (e.all)

            можно писать:

               retrieve (salary.all)


       4. Введена возможность размещать базу данных в  произволь-
         ном  справочнике.  Для этого при создании базы в команде
         CREATDB добавляется ключ  -dимя_справочника  (справочник
         не должен существовать). По этой команде система создает
         указанный справочник и размещает в нем базу данных, а  в
         справочнике  ~/data/base  создается файл под именем базы
         данных (указанным в CREATDB), содержащий ссылку на поло-
         жение  базы данных в системе. В дальнейшем все обращения
         к базе осуществляются по этому имени. Подробнее см. опи-
         сание команды creatdb (раздел "ДЕМОС").

       5. Улучшена работа с виртуальными отношениями. Во  первых,
         снят  ряд  ограничений  на их использование в операторах
         _r_e_t_r_i_e_v_e _r_e_p_l_a_c_e _a_p_p_e_n_d _d_e_l_e_t_e - ссылки на них могут по-
         являться без ограничения в квалификации и в правой части
         выражений в целевом списке, а также в  агрегатах.   Исп-
         равлена ошибка, из за которой агрегатные функции от вир-
         туальных отношений вычислялись неправильно (не  подстав-
         лялось условие).

       6. Исправлена обработка ограничений доступа в  случае  _d_e_-
         _f_i_n_e _p_e_r_m_i_t _r_e_t_r_i_e_v_e  .. _t_o _a_l_l - данное отношение может
         появляться в любых операторах в правой части выражений.

       7. В оператор _h_e_l_p (и в команду _h_e_l_p_r )  введены  ключевые
         слова  "short",  "my",  "real", изменяющие формат выдачи
         справочной информации.   Ключ  "short"  вызывает  печать
         справок  в  компактном  формате, "real" блокирует выдачу
         информации о системных и  виртуальных  отношениях  и  об
         вторичных  индексах,  ключ "my" вызывает просмотр только
         тех отношений, хозяином которых является данный  пользо-
         ватель.  В стартовом файле монитора определен ряд корот-
         ких макро ("ls" - help short, lr - help short real, lm -
         help short my) для компактной выдачи справок.


                              - 2 -








ИИЗЗММЕЕННЕЕННИИЯЯ ВВ РРУУББИИНН 22..1144(())                 ИИЗЗММЕЕННЕЕННИИЯЯ ВВ РРУУББИИНН 22..1144(())


       8. В монитор внесена новая команда:

          \!команда_ДЕМОС

         для выполнения команд операционной системы без выхода из
         СУБД.
















































                              - 3 -








ССООДДЕЕРРЖЖААННИИЕЕ((РРУУББИИНН))            33//2233//7799            ССООДДЕЕРРЖЖААННИИЕЕ((РРУУББИИНН))



     EQUEL(QUEL) - краткое описание языка EQUEL

     MACROS(QUEL) - описание языка макропроцессора монитора

     QUEL(QUEL) - краткое описание языка QUEL

     APPEND(QUEL) - добавить кортежи к отношению
         aappppeenndd [ttoo] имя_отн (список_объектов) [wwhheerree условие]

     COPY(QUEL) - скопировать данные в/из отношения из/в файл ДЕ-
         МОС.
         ccooppyy имя_отн (имя_домена = формат {, имя_домена = формат
         })
                   направление "имя файла"

     CREATE(QUEL) - создать новое отношение
         ccrreeaattee имя_отн (имя_домена_1 = формат  {,  имя_домена_2  =
         формат })

     DEFINE(QUEL) - определить подсхему
         ddeeffiinnee vviieeww имя (список_объектов) [ wwhheerree условие ]
         ddeeffiinnee ppeerrmmiitt список_операций { oonn | ooff | ttoo }  перемен-
              ная  [  (список)  ]  ttoo  имя [ aatt терминал ] [ ffrroomm
              время ttoo время ] [ oonn  день_нед  ttoo  день_нед  ]  [
              wwhheerree условие ]
         ddeeffiinnee iinntteeggrriittyy oonn переменная iiss условие

     DELETE(QUEL) - удалить кортежи из отношения
         ddeelleettee кортеж_переменная [wwhheerree условие]

     DESTROY(QUEL) - уничтожить существующее отношение(я)
         ddeessttrrooyy имя_отн {, имя_отн}
         ddeessttrrooyy [ppeerrmmiitt | iinntteeggrriittyy]  имя_отн  [integer  {,  in-
         teger}| aallll]

     HELP(QUEL) - получить информацию о том, как использовать РУ-
         БИН или об отношениях в базе данных.
         hheellpp    [имя_отн]    ["имя_статьи"]    {,     имя_отн}{,
         "имя_статьи"}
         hheellpp vviieeww имя_отн {, имя_отн}
         hheellpp ppeerrmmiitt имя_отн {, имя_отн}
         hheellpp iinntteeggrriittyy имя_отн {, имя_отн}

     INDEX(QUEL) - создать вторичный индекс на существующем отно-
         шении.
         iinnddeexx oonn имя_отн iiss имя_индекса (домен_1 { ,домен_2})

     INTEGRITY(QUEL) - определить ограничение целостности.
         ddeeffiinnee iinntteeggrriittyy oonn переменная iiss условие

     MACROS(QUEL) - макровозможности терминального монитора.


                              - 1 -








ССООДДЕЕРРЖЖААННИИЕЕ((РРУУББИИНН))            33//2233//7799            ССООДДЕЕРРЖЖААННИИЕЕ((РРУУББИИНН))



     MODIFY(QUEL) - преобразовать структуру памяти отношения.
         mmooddiiffyy имя_отн  ttoo  структура_памяти  [  oonn  ключ1  [  :
              _п_о_р_я_д_о_к__с_о_р_т ] [ { , ключ2 [ : _п_о_р_я_д_о_к__с_о_р_т ] } ] ]
              [ wwhheerree [ ffiillllffaaccttoorr == _n ] [ ,, mmiinnppaaggeess == _n ]  [  ,,
              mmaaxxppaaggeess == _n ] ]

     MONITOR(QUEL) - интерактивный терминальный монитор.

     PERMIT(QUEL) - добавить разрешение в отношение.
         ddeeffiinnee ppeerrmmiitt список_операций { oonn | ooff | ttoo }  перемен-
         ная [ (список) ]
              ttoo имя [ aatt терминал ] [ ffrroomm время ttoo время ]
              [ oonn день_нед ttoo день_нед ] [ wwhheerree условие ]

     PRINT(QUEL) - печатать отношение(я).
         pprriinntt имя_отн {, имя_отн}

     RANGE(QUEL) - об'явить переменную для распространения на от-
         ношение.
         rraannggee ooff переменная iiss имя_отн

     REPLACE(QUEL) - заменить значения доменов в отношении.
         rreeppllaaccee кортеж_переменная (список_объектов) [wwhheerree усло-
         вие]

     RETRIEVE(QUEL) - выдать кортежи из отношения.
         rreettrriieevvee [[iinnttoo] имя_отн] (список_объектов) [wwhheerree усло-
         вие]
         rreettrriieevvee uunniiqquuee (список_объектов) [wwhheerree условие]

     SAVE(QUEL) - хранить отношение вплоть до заданной даты.
         ssaavvee имя_отн uunnttiill месяц день год

     VIEW(QUEL) - определить виртуальное отношение.
         ddeeffiinnee vviieeww имя (список_объектов) [ wwhheerree условие ]

     COPYDB(ДЕМОС) - создание файлов-заданий, копирующих и  восс-
         танавливающих базу данных.
         ccooppyyddbb [ --uu_и_м_я [ база_данных полное_имя_каталога [ отно-
         шение ... ]

     CREATDB(ДЕМОС) - создать базу данных.
         ccrreeaattddbb [ --uu_и_м_я ] [ --ee ] [ --mm ] [ __++cc ] [ __++qq ] имя_бд

     DESTROYDB(ДЕМОС) - уничтожить существующую базу данных.
         ddeessttrrooyyddbb [ --ss ] [ --mm ] имя_бд

     EQUEL(ДЕМОС) - встроенный в язык C интерфейс с QUEL.
         eeqquueell [ --dd ] [ --ff ] [ --rr ] file.q ...

     HELPR(ДЕМОС) - получить информацию о базе данных.


                              - 2 -








ССООДДЕЕРРЖЖААННИИЕЕ((РРУУББИИНН))            33//2233//7799            ССООДДЕЕРРЖЖААННИИЕЕ((РРУУББИИНН))


         hheellpprr [ --uu_и_м_я ] [ __++ww ] база_даных отношение ...

     РУБИН(ДЕМОС) - система управления реляционной  базой  данных
         РУБИН.
         rruubbiinn [ _к_л_ю_ч_и ] имя_бд [ таблица_процессов ]

     PRINTR(ДЕМОС) - печатать отношения.
         pprriinnttrr [ _к_л_ю_ч_и ] база_данных отношение ...

     PURGE(ДЕМОС) - уничтожить все промежуточные и временные  от-
         ношения.
         ppuurrggee [ --ff ] [ --pp ] [ --aa ] [ --ss ] [ __++ww ]  [  база_данных
         ... ]

     RESTORE(ДЕМОС) - восстановление после аварии  РУБИН или  ДЕ-
         МОС .
         rreessttoorree [ --aa ] [ --ss ] [ __++ww ] [ база_данных ... ]

     SYSMOD(ДЕМОС) - привести системные отношения  к  предопреде-
         ленным структурам памяти.
         ssyyssmmoodd [ --ss ] [ --ww ] имя_бд [ rreellaattiioonn ] [ aattttrriibbuuttee ] [
         iinnddeexxeess ] [ ttrreeee ] [ pprrootteecctt ] [ iinntteeggrriittiieess ]

     USERSETUP(ДЕМОС) - создать файл пользователей "users".
         ......//bbiinn//uusseerrsseettuupp [ полное_имя_файла ]

     DAYFILE(FILES) - регистрационное сообщение РУБИН.

     DBTMPLT(FILES) - шаблон базы данных.

     ERROR(FILES) - файлы с ошибками РУБИН.

     LIBQ(FILES) - библиотека функций EQUEL.

     PROCTAB(FILES) - информация о конфигурации  РУБИН  во  время
         работы.

     STARTUP(FILES) - файл инициализации РУБИН.

     USERS(FILES) - коды и параметры пользователя РУБИН.

     INTRODUCTION(ERROR) - введение по сообщениям об ошибках.

     EQUEL(ERROR) - сводка сообщений об ошибках EQUEL.
         Номера ошибок 1000 - 1999.

     PARSER(ERROR) - сводка  сообщений  об  ошибках  лексического
         анализатора.
         Номера ошибок 2000 - 2999.

     QRYMOD(ERROR) - сводка сообщений об ошибках модификаций зап-
         росов.


                              - 3 -








ССООДДЕЕРРЖЖААННИИЕЕ((РРУУББИИНН))            33//2233//7799            ССООДДЕЕРРЖЖААННИИЕЕ((РРУУББИИНН))


         Номера ошибок 3000 - 3999.

     OVQP(ERROR) - сводка сообщений об ошибках процессора  запро-
         сов с одной переменной.
         Номера ошибок 4000 - 4499.

     DECOMP(ERROR) - сводка сообщений об ошибках декомпозиции.
         Номера ошибок 4500 - 4999.

     DBU(ERROR) - сводка сообщений об ошибках обслуживающих прог-
         рамм базы данных.
         Номера ошибок 5000 - 5999










































                              - 4 -




