
DUMP(8)         ДЕМОС. Сопровождение системы         DUMP(8)


ИИММЯЯ
        dduummpp - получение копии файловой системы на ленте.

ФФООРРММААТТ
        dduummpp [--nn] _к_л_ю_ч [_п_а_р_а_м_е_т_р...] _ф_а_й_л_о_в_а_я-_с_и_с_т_е_м_а
        [_и_м_я-_ф_а_й_л_о_в_о_й-_с_и_с_т_е_м_ы [_к_о_м_м_е_н_т_а_р_и_й]]

ООППИИССААННИИЕЕ
        Команда dduummpp предназначена для полного  или  частич-
        ного  копирования  файловой системы (как правило, на
        магнитную ленту).  Она  позволяет  вести  регулярное
        копирование информации на ленты, причем записываются
        только измененные файлы, что  значительно  сокращает
        объем  информации, и при необходимости делать полные
        копии.  Команда  ведет  учетный  файл  информации  о
        копировании   /_e_t_c/_d_u_m_p_d_a_t_e,  в  котором  содержатся
        имена файловых систем, "уровни" и даты  копирования,
        а также дополнительная информация.

        Команда управляется следующими ключами:

        --nn  если задан этот ключ, производится только  подс-
            чет  объема  информации, подлежащей дампированию
            (без записи на ленту).

        _ч_и_с_л_о от 0 до 999
            уровень "выгрузки". В файле /_e_t_c/_d_u_m_p_d_a_t_e  отыс-
            кивается запись о наиболее поздней выгрузке ука-
            занной файловой системы  с  "уровнем"  выгрузки,
            меньшим указанного, и производится запись только
            тех файлов, которые изменялись с момента  преды-
            дущего копирования. Если уровень равен 0, либо в
            файле не найдено инормации о копировании указан-
            ной  файловой системы, то производится копирова-
            ние всей файловой системы.   Уровень  999  имеет
            особое  значение - он заменяется на максимальный
            уровень предыдущей выгрузки, плюс 1.

        uu   Если операция записи завершается успешно, инфор-
            мация  в файле /_e_t_c/_d_u_m_p_d_a_t_e обновляется - запи-
            сывается имя файловой системы, уровень выгрузки,
            дата  и время выгрузки и дополнительная информа-
            ция.

        ss   Указывает размер ленты для  копирования.  Размер
            задается в следующем _п_а_р_а_м_е_т_р_е в одном из форма-
            тов:

            <_ч_и_с_л_о>   - означает длину ленты в футах;

            <_ч_и_с_л_о>mm  - означает длину ленты в метрах;

            <_ч_и_с_л_о>kk  - означает емкость ленты в килобайтах;

            <_ч_и_с_л_о>MM  - означает емкость ленты в мегабайтах;

            _п_а_р_а_м_е_т_р:_п_а_р_а_м_е_т_р
                      первый _п_а_р_а_м_е_т_р означает длину  первой


                            -1-                      ДЕМОС/P


DUMP(8)         ДЕМОС. Сопровождение системы         DUMP(8)


                      ленты,   второй  -  длину  последующих
                      лент.

            При исчерпании ленты dduummpp просит установить сле-
            дующую  ленту  и ввести _n_e_x_t"возврат каретки" По
            умолчанию подразумевается лента емкостью 10Мбайт
            (малая бобина для СМ ЭВМ).

        dd   Плотность записи на ленту, выраженная в битах на
            дюйм  (1 бит/дюйм = 0,4 бит/см), берется из сле-
            дующего за ключом _п_а_р_а_м_е_т_р_а.   Она  используется
            для  вычисления  длины ленты, использованной при
            записи. Значение  по  умолчанию  равно  800  (32
            бит/мм). Если емкость ленты указана в килобайтах
            или мегабайтах, этот параметр задавать нельзя.

        ff   следующий _п_а_р_а_м_е_т_р  указывает  имя  файла  (уст-
            ройства),  на которое будет вестись копирование.
            По умолчанию используется имя из макропеременной
            среды TTAAPPEE, или устройство /_d_e_v/_n_r_m_t_0.

        Следующий параметр представляет собой  имя  файловой
        системы.  Это  может  быть  либо  имя устройства, на
        котором она размещена, либо имя каталога, на котором
        она  смонтирована.   За  ним может идти имя файловой
        системы, используемое для ее  идентификации  в  сис-
        теме,  в  том  числе  и  в /_e_t_c/_d_u_m_p_d_a_t_e.  Следующий
        параметр просто  переписывается  в  /_e_t_c/_d_u_m_p_d_a_t_e  и
        используется как комментарий.

        Команда dduummpp работает следующим образом:

        1)  Если указанное имя -  имя  каталога,  то  ищется
            устройство, которое смонтировано на данный ката-
            лог;

        2)  Для идентификации  файловой  системы  в  учетном
            файле  используется  _и_м_я  _ф_а_й_л_о_в_о_й _с_и_с_т_е_м_ы либо,
            если оно не указано явно, используется имя ката-
            лога, на котором файловая система была смонтиро-
            вана последний раз;

        3)  Находится самый поздний дамп файловой системы  с
            уровнем  выгрузки, меньше текущего. Время созда-
            ния этого дампа  используется  как  базовое  при
            копировании - копируются  только те файлы, кото-
            рые изменялись с момента этой выгрузки;

        4)  производится само копирование файлов  на  ленту,
            причем  оно  идет на физическом уровне (файловая
            системы читается напрямую).  При  этом  файловая
            система не должна изменяться.

        5)  Если все кончилось благополучно,  и  был  указан
            ключ uu, в файле /_e_t_c/_d_u_m_p_d_a_t_e обновляется инфор-
            мация о выгрузке с указанным уровнем.

        6)  Печатается  информация  об  свободном  месте  на


                            -2-                      ДЕМОС/P


DUMP(8)         ДЕМОС. Сопровождение системы         DUMP(8)


            ленте   (по   каналу  стандартного  вывода).   В
            результате все время существует  базовая  копия,
            копия с уровнем 0 и, возможно, несколько копий с
            уровнем 1. При каждом последующем копировании  с
            уровнем  9 записываются только те файлы, которые
            изменились после копирования с уровнем 1.

        Для полной выгрузки на ленту используется вызов dduummpp
        в форме:

                dduummpp 0ff /_d_e_v/_n_r_m_tXX

        Стандартная процедура копирования состоит в  следую-
        щем.  Сначала делается полная копия файловой системы
        на ленту, например:

                dduummpp 0uu /_u_s_r

        Затем  ежедневно  делается  копирование   измененной
        информации  на другую ленту (желательно использовать
        хотя бы две ленты, через раз):

                dduummpp 9uu /_u_s_r

        При этом каждый раз заново записываются файлы, изме-
        нившиеся  с  момента  записи  дампа  уровня 0. Когда
        объем этих файлов приблизится к объему  одной  ленты
        либо  станет  соизмерим с размером файловой системы,
        повторяется копия уровня 0.  Если  файловая  система
        достаточно  велика  (например, не влезает целиком на
        одну ленту), имеет смысл сделать копию уровня  1  на
        еще одну ленту и хранить три копии: уровня 0 (делае-
        мую редко),  уровня  1,  которая  делается  чаще,  и
        уровня  9,  которая может делаться практически ежед-
        невно; для не очень больших  файловых  систем  имеет
        смысл  хранить  копию  уровня  0 и ежедневную копию,
        делаемую на уровне 9.

        Еще один вариант состоит в том, что  делается  копия
        всей  файловой  системы (уровня 0) и затем на другую
        ленту ежедневно записывается  последовательно  копия
        уровня  1,  2,  3,  ...,  причем  запись  каждый раз
        ведется в конец ленты.  Этот способ уменьшает  объем
        записи,  но  надежность  хранения информации меньше,
        так как все копии (кроме начальной)  размещаются  на
        одной ленте, а сохранность их не контролируется.

        Если dduummpp используется для записи нескольких  файлов
        на  одну  ленту,  то  информацию  о длине оставшейся
        части ленты рекомендуется передавать следующим обра-
        зом (на примере командного файла ccsshh):

        sseett _r_e_s_t = 10000
        ffoorreeaacchh _n_a_m_e ( /_u_s_r/_s_r_c /_m_n_t/_u_s_e_r_s /_n_e_w_s_y_s )
        sseett _r_e_s_t=`dduummpp 9ss ${_r_e_s_t}kk:10000kk $_n_a_m_e` |||| \\
            (eecchhoo $_n_a_m_e error; eexxiitt 1)
        eenndd



                            -3-                      ДЕМОС/P


DUMP(8)         ДЕМОС. Сопровождение системы         DUMP(8)


ФФААЙЙЛЛЫЫ
        /_e_t_c/_d_u_m_p_d_a_t_e   имена файловых систем, номера  уров-
                        ней  и  даты  записи в файловую сис-
                        тему;

ДДООППООЛЛННИИТТЕЕЛЛЬЬННЫЫЕЕ ССССЫЫЛЛККИИ
        _r_e_s_t_o_r(8), _d_u_m_p_d_i_r(8).

ЗЗААММЕЕЧЧААННИИЯЯ
        Ошибки при чтении файловой системы игнорируются.

        Ошибки  при  записи  на  магнитную  ленту  считаются
        фатальными.

        При использовании ключа --nn команда  dduummpp  возвращает
        не остаток на ленте, а объем подлежащей дампированию
        информации.











































                            -4-                      ДЕМОС/P

