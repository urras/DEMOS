
DIRECTORY(3X)   ДЕМОС. Библиотечные функции    DIRECTORY(3X)


ИИММЯЯ
       ooppeennddiirr,  rreeaaddddiirr,   tteellllddiirr,   sseeeekkddiirr,   rreewwiinnddddiirr,
       cclloosseeddiirr - работа с каталогами с именами произвольной
       длины

ФФООРРММААТТ
       #iinncclluuddee <_n_d_i_r._h>

       DDIIRR *ooppeennddiirr(_f_i_l_e_n_a_m_e)
       cchhaarr *_f_i_l_e_n_a_m_e;

       ssttrruucctt ddiirreecctt *rreeaaddddiirr(_d_i_r_p)
       DDIIRR *_d_i_r_p;

       lloonngg tteellllddiirr(_d_i_r_p)
       DDIIRR *_d_i_r_p;

       sseeeekkddiirr(_d_i_r_p, _l_o_c)
       DDIIRR *_d_i_r_p;
       lloonngg _l_o_c;

       rreewwiinnddddiirr(_d_i_r_p)
       DDIIRR *_d_i_r_p;

       cclloosseeddiirr(_d_i_r_p)
       DDIIRR *_d_i_r_p;

       cccc ... --llnnddiirr

ООППИИССААННИИЕЕ
       Эта библиотека предназначена для  имитации  работы  с
       каталогами  с длинными именами файлов версии Демос-32
       на файловой системе ДЕМОС 2.1.  Программы, использую-
       щие  эту  библиотеку  для работы с каталогами, непос-
       редственно переносимы в Демос-32.

       Функция ooppeennddiirr открывает каталог с именем _f_i_l_e_n_a_m_e и
       связывает  с  ним  _ф_а_й_л-_к_а_т_а_л_о_г.   ooppeennddiirr возвращает
       указатель, задающий  в  последующих  операциях  файл-
       каталог  (указатель  на  тип DDIIRR).  Если имя _f_i_l_e_n_a_m_e
       указывает на недоступный или несуществующий  каталог,
       то возвращается значение NNUULLLL.

       Процедура rreeaaddddiirr читает элемент каталога, на котором
       стоит  указатель  чтения, смещает указатель чтения на
       следующий элемент каталога и возвращает указатель  на
       структуру ddiirreecctt, описанную следующим образом:

       #ddeeffiinnee MMAAXXNNAAMMLLEENN       255

       ssttrruucctt  ddiirreecctt {
           lloonngg  dd__iinnoo;     /* номер I-узла */
           sshhoorrtt dd__rreecclleenn;  /* длина этой записи */
           sshhoorrtt dd__nnaammlleenn;  /* длина строки в dd__nnaammee */
                            /* имя элемента каталога */
           cchhaarr  dd__nnaammee[MMAAXXNNAAMMLLEENN+1];
       }



                            -1-                      ДЕМОС/P


DIRECTORY(3X)   ДЕМОС. Библиотечные функции    DIRECTORY(3X)


       При достижении конца каталога  или  после  выполнения
       sseeeekkddiirr  с  недопустимыми аргументами rreeaaddddiirr возвра-
       щает значение NNUULLLL.

       Функция tteellllddiirr возвращает текущее  положение  указа-
       теля чтения файла-каталога _d_i_r_p.

       Процедура  sseeeekkddiirr  устанавливает  позицию  указателя
       чтения  для  следующей  операции  rreeaaddddiirr над файлом-
       каталогом.  Использовать  можно  только  те  значения
       _l_o_c,  которые  были получены с помощью tteellllddiirr с этим
       же файлом-каталогом.  Значения, возвращенные tteellllddiirr,
       корректны  только  во  время жизни указателя _d_i_r_p, по
       которому они были получены.  Если каталог был  закрыт
       и  открыт  снова, старые значения tteellllddiirr могут стать
       неправильными из-за уплотнения каталога.

       Процедура rreewwiinnddddiirr устанавливает  позицию  указателя
       чтения файла-каталога _d_i_r_p на начало каталога.

       cclloosseeddiirr закрывает файл-каталог и освобождает  струк-
       туру, на которую указвает _d_i_r_p.

ППРРИИММЕЕРР
       Для поиска в текущем каталоге элемента с именем  _n_a_m_e
       лучше всего использовать следующий фрагмент:

       _l_e_n = ssttrrlleenn(_n_a_m_e);
       _d_i_r_p = ooppeennddiirr(".");
       ffoorr (_d_p = rreeaaddddiirr(_d_i_r_p);
                 _d_p != NNUULLLL;
                      _d_p = rreeaaddddiirr(_d_i_r_p))
           iiff (_d_p->dd__nnaammlleenn == _l_e_n
           && !ssttrrccmmpp(_d_p->dd__nnaammee, _n_a_m_e)) {
               cclloosseeddiirr(_d_i_r_p);
               rreettuurrnn _F_O_U_N_D;
           }
       cclloosseeddiirr(_d_i_r_p);
       rreettuurrnn _N_O_T__F_O_U_N_D;

ДДООППООЛЛННИИТТЕЕЛЛЬЬННЫЫЕЕ ССССЫЫЛЛККИИ
       _o_p_e_n(2), _c_l_o_s_e(2), _r_e_a_d(2), _l_s_e_e_k(2), _d_i_r(5)


















                            -2-                      ДЕМОС/P

