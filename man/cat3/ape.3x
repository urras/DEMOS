
APE(3X)         ДЕМОС. Библиотечные функции          APE(3X)


ИИММЯЯ
       aappee -  подпрограммы  для  арифметических  действий  с
       целыми числами произвольной точности.

ВВЫЫЗЗООВВЫЫ
       #iinncclluuddee <_a_p_e._h>

       cccc ... --llaappee

       ff7777 ... --llaappee

ООППИИССААННИИЕЕ
       Библиотека _a_p_e - это набор подпрограмм для  арифмети-
       ческих действий с целыми произвольной точности, кото-
       рые могут быть вызваны как из Си-программ, так  и  из
       программ на Фортране-77.

       Подпрограммы работают со структурой MMIINNTT (_m_u_l_t_i_p_r_e_c_i_-
       _s_i_o_n _i_n_t_e_g_e_r), определенной как

       ttyyppeeddeeff ssttrruucctt mmiinntt {
           iinntt    lleenn;   /* длина */
           sshhoorrtt *vvaall;   /* значение */
       }
           MMIINNTT, *PPMMIINNTT;

       Поле lleenn - это целое, знак которого  является  знаком
       изображаемого числа, а модуль - количество слов (типа
       sshhoorrtt), необходимых для  его  хранения.   Непосредст-
       венно  число  (его  абсолютное значение) хранится как
       массив типа sshhoorrtt iinntt, на который указывает поле vvaall.
       Память под этот массив выделяется процедурой mmaalllloocc и
       освобождается при помощи ffrreeee (см.  _m_a_l_l_o_c(3)).

       Размер представимого числа ограничен  только  объемом
       доступной  памяти; на СМ-4, например, успешно обраба-
       тываются числа с 20000 цифр.

       Подпрограммы библиотеки _a_p_e можно разделить на четыре
       категории:

       ИИннииццииааллииззаацциияя ии ууддааллееннииее

       Указатели на структуру MMIINNTT  (тип  PPMMIINNTT)  необходимо
       инициализировать,  прежде  чем их смогут использовать
       другие программы. Это  делается  следующими  процеду-
       рами:

              nneeww(_p_a)
              PPMMIINNTT *_p_a;

              PPMMIINNTT sshhttoomm(_s_n)
              sshhoorrtt _s_n;

              PPMMIINNTT iittoomm(_n)
              iinntt _n;

              PPMMIINNTT llttoomm(_l_n)


                            -1-                      ДЕМОС/P


APE(3X)         ДЕМОС. Библиотечные функции          APE(3X)


              lloonngg _l_n;

              PPMMIINNTT ssttoomm(_s)
              cchhaarr *_s;

       nneeww(&_a) создает пустую  структуру  MMIINNTT,  на  которую
       будет указывать переменная _a.  Другие функции возвра-
       щают указатели на структуры MMIINNTT со значениями,  рав-
       ными  их  аргументам (или числовому эквиваленту аргу-
       мента для ssttoomm).  При преобразовании строки  в  число
       процедура  ssttoomm  следует обычному соглашению языка Си
       относительно системы счисления вводимого числа.

       Для освобождения памяти предусмотрены две программы:

              xxffrreeee(_a)
              PPMMIINNTT _a;

              aaffrreeee(_a)
              PPMMIINNTT _a;

       Процедура xxffrreeee(_a) освобождает то, на  что  указывает
       _a->vvaall,  обнуляя  таким  образом значение _a; aaffrreeee(_a)
       освобождает, кроме того, и структуру MMIINNTT, на которую
       указывает _a.

       ААррииффммееттииччеессккииее ддееййссттввиияя

       Далее в примерах будут использоваться следующие обоз-
       начения переменных (с подразумеваемым для них типом):

              PPMMIINNTT  _a, _b, _c, _d, _q, _r;
              iinntt    _m, _n;
              lloonngg   _l_n;
              sshhoorrtt *_R;

            _П_р_о_г_р_а_м_м_а         _Р_е_з_у_л_ь_т_а_т

            mmaadddd(_a,_b,_c)       _c = _a + _b
            mmssuubb(_a,_b,_c)       _c = _a - _b
            mmuulltt(_a,_b,_c)       _c = _a * _b
            ssddiivv(_a,_m,_q,_R)     _q = _a / _m;  _R = _a mmoodd _m
            mmddiivv(_a,_b,_q,_r)     _q = _a / _b;  _r = _a mmoodd _b
            ggccdd(_a,_b,_c)        _c = ggccdd(_a,_b)
            rreecciipprrooccaall(_a,_n,_b) _b = 10^_n / _a
            mmssqqrrtt(_a,_b,_r)      _b = ssqqrrtt(_a); _r = _a - _b*_b
                              [возвращается длина _r]
            ppooww(_a,_b,_c,_d)      _d = _a^_b mmoodd _c
            rrppooww(_a,_n,_b)       _b = _a^_n
            llppooww(_n,_l_n,_b)      _b = _n^_l_n

       Во всех случаях вызовы типа mmaadddd(_a,_b,_a)  разрешены  и
       дают  ожидаемый результат.  Программы, имеющие дело с
       типом iinntt, не различают типы sshhoorrtt и iinntt, кроме прог-
       раммы ssddiivv, для которой целое _m не должно быть больше
       наибольшего числа типа sshhoorrtt.  rreecciipprrooccaall  предназна-
       чена для работы с десятичными дробями.



                            -2-                      ДЕМОС/P


APE(3X)         ДЕМОС. Библиотечные функции          APE(3X)


       Сравнение  делается   функцией   mmccmmpp.    Если   _a>_b,
       mmccmmpp(_a,_b)  возвращает  положительное число, если _a<_b,
       отрицательное, а если _a=_b, то ноль.

       ВВввоодд ии ввыыввоодд

       Ввод и вывод делают следующие функции:

              PPMMIINNTT _a;
              iinntt   _n;  /* _n должно быть > 1 */
              FFIILLEE *_f;
              cchhaarr *_s;

              mm__iinn(_a,_n,_f)
                 вводит число в системе с основанием
                 _n из файла _f в _a
              ssmm__iinn(_a,_n,_s)
                 вводит число в системе с основанием
                 _n из строки _s в _a
              mm__oouutt(_a,_n,_f)
                 выводит _a в системе с основанием
                 _n в файл _f
              ssmm__oouutt(_a,_n,_s)
                 выводит _a в системе с основанием
                 _n в строку _s

       Функция mm__iinn возвращает 0 при нормальном завершении и
       EEOOFF, если достигнут  конец входного файла.

       Для систем с основаниями 8 и 10 предусмотрены  специ-
       альные версии этих программ:

            PPMMIINNTT _a;
            FFIILLEE *_f;

            Восьмеричная система счисления

            oomm__iinn(_a,_f)
            oommiinn(_a)        [_f=ssttddiinn]
            oomm__oouutt(_a,_f)
            oommoouutt(_a)       [_f=ssttddoouutt]


            Десятичная система счисления

            ffmmiinn(_a,_f)
            mmiinnppuutt(_a)      [_f=ssttddiinn]
            ffmmoouutt(_a,_f)
            mmoouutt(_a)        [_f=ssttddoouutt]

       ИИссппооллььззооввааннииее ббииббллииооттееккии aappee вв ФФооррттррааннее--7777

       Для использования  библиотеки  _a_p_e  в  программах  на
       Фортране-77  предусмотрен набор интерфейсных подпрог-
       рамм.  Целые числа из вызывающей программы при помощи
       этих подпрограмм преобразуются в PPMMIINNTT, которые затем
       передаются подпрограммам библиотеки _a_p_e.



                            -3-                      ДЕМОС/P


APE(3X)         ДЕМОС. Библиотечные функции          APE(3X)


       Имена и синтаксис этих подпрограмм в  основном  такие
       же, как и у аналогичных подпрограмм языка Си.  Исклю-
       чения из этого правила:

            _Ф_о_р_т_р_а_н-_7_7            _а_н_а_л_о_г _н_а _С_и

            iinntteeggeerr _n,_a           iinntt n;  PPMMIINNTT _a;
            cchhaarraacctteerr**_M _s         cchhaarr _s[_M];

            ccaallll nneeww(_a)           nneeww(&_a);
            ccaallll iittoomm(_n,_a)        _a = iittoomm(_n);
            ccaallll ssttoomm(_s,_a)        _a = ssttoomm(_s);

            ccaallll mmiinnppuutt(_a,_n)      _n = mmiinnppuutt(_a);
            ccaallll oommiinn(_a,_n)        _n = oommiinn(_a);
            ccaallll mmoouutt(_a)          mmoouutt(_a);
            ccaallll oommoouutt(_a)         mmoouutt(_a);
        (других программ ввода/вывода для Фортрана-77 нет)

       Библиотека содержит подпрограммы  для  преобразования
       структур  MMIINNTT в структуру данных, с которой работает
       Фортран, состоящую из числа типа  iinntteeggeerr  и  массива
       типа iinntteeggeerr*2:

       iinntteeggeerr _a, _l_e_n_g_t_h   [_a представляет PPMMIINNTT]
       iinntteeggeerr**22 _v_e_c_t_o_r(_N) [должно быть aabbss(_l_e_n_g_t_h)..llee.._N]

       ccaallll mmttoovveecc(_a,_l_e_n_g_t_h,_v_e_c_t_o_r)
           результаты:
               _l_e_n_g_t_h = _a->lleenn
               ffoorr _i = 1 ttoo aabbss(_l_e_n_g_t_h)
                   _v_e_c_t_o_r(_i) = _a->vvaall[_i-1]

       ccaallll vveeccttoomm(_l_e_n_g_t_h,_v_e_c_t_o_r,_a)
           результаты:
               _a->lleenn = _l_e_n_g_t_h
               ffoorr _i = 1 ttoo aabbss(_l_e_n_g_t_h)
                   _a->vvaall[_i-1] = _v_e_c_t_o_r(_i)

       Вторая процедура обычно используется для  инициализа-
       ции.

ФФААЙЙЛЛЫЫ
       /_u_s_r/_i_n_c_l_u_d_e/_a_p_e._h  include-файл
       /_u_s_r/_l_i_b/_l_i_b_a_p_e._a   объектная библиотека

ДДООППООЛЛННИИТТЕЕЛЛЬЬННЫЫЕЕ ССССЫЫЛЛККИИ
       _b_c(1), _d_c(1), _m_a_l_l_o_c(3)

ДДИИААГГННООССТТИИККАА
       Недопустимые операции и переполнение памяти  вызывают
       выдачу сообщений и дампирование памяти.

ЗЗААММЕЕЧЧААННИИЯЯ
       Основание системы  счисления  входных  данных  должно
       быть меньше или равным 35.




                            -4-                      ДЕМОС/P


APE(3X)         ДЕМОС. Библиотечные функции          APE(3X)


       Восьмеричный ввод медленнее, чем хотелось бы.



























































                            -5-                      ДЕМОС/P

