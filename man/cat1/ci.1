
CI(1)                  ДЕМОС. Команды                  CI(1)


ИИММЯЯ
       ccii - запись версий в архив RCS.

ФФООРРММААТТ
       ccii [_к_л_ю_ч] _ф_а_й_л...

ООППИИССААННИИЕЕ
       Команда ccii записывает новые версии рабочих  файлов  в
       архивные  файлы системы RRCCSS.  Каждое имя файла, окан-
       чивающееся на `,_v' рассматривается как имя RRCCSS-файла,
       предполагается,  что файлы с другими именами являются
       рабочими и содержат новые версии.

       Для записи содержимого рабочего файла в архивный файл
       системе  требуется определить имена этих файлов.  Они
       могут оба непосредственно  задаваться  пользователем,
       либо  (если  одно  из  имен  опущено) определяться по
       умолчанию.

       При задании файлов возможны следующие случаи:

       1) Заданы как архивный,  так  и  рабочий  файлы.  Имя
       архивного  файла  RRCCSS имеет вид: _p_a_t_h_1/_w_o_r_k_f_i_l_e,_v , а
       имя рабочего файла задано в форме _p_a_t_h_2/_w_o_r_k_f_i_l_e, где
       _p_a_t_h_1/  и  _p_a_t_h_2/  являются  (возможно различными или
       пустыми) полными именами пути,  а  _w_o_r_k_f_i_l_e  является
       именем файла.

       2) Задан только архивный файл RRCCSS.  Тогда предполага-
       ется,  что рабочий файл находится в текущем каталоге,
       а его имя получается из имени архивного файла  удале-
       нием _p_a_t_h_1/ и суффикса `,_v'.

       3) Задан только рабочий  файл.   В  этом  случае  имя
       архивного  файла  получается  из имени рабочего файла
       удалением _p_a_t_h_2/ и добавлением суффикса `,_v'.

       Если полное имя архивного файла не задано, или приве-
       дено только базовое имя (т.е. не указано точное поло-
       жение файла в  файловой  системе),  команда  пытается
       найти  архивный  файл в каталоге, заданном макропере-
       менной среды RRCCSS, или  (если  переменная  не  опреде-
       лена),  в  каталоге  ./_R_C_S  и,  если такой подкаталог
       отсутствует в текущем каталоге, или  искомый  файл  в
       нем  не  содержится,  поиск  осуществляется в текущем
       каталоге.

       Для работы с командой ccii необходимо включить в список
       доступа  соответствующего  файла  регистрационное имя
       пользователя.  Эта операция не является обязательной,
       если  список доступа пуст (контроль доступа не произ-
       водится), или пользователь является  суперпользовате-
       лем  либо  хозяином  файла.  Для того, чтобы добавить
       новую версию к существующей ветви, старшая версия  на
       этой  ветви  должна быть заблокирована пользователем.
       В противном случае  может  создаваться  только  новая
       ветвь.   Это ограничение не распространяется на хозя-
       ина   файла,   в    противном    случае    блокировка


                            -1-                     ДЕМОС/PV


CI(1)                  ДЕМОС. Команды                  CI(1)


       устанавливается на ssttrriicctt (см. _r_c_s (1)).  Блокировка,
       установленная  кем-то  другим,  может  быть  снята  с
       помощью команды rrccss.

       Обычно команда  ccii  проверяет,  отличается  ли  вновь
       записываемая  версия  от предыдущей. Если различий не
       обнаружено, запись просто не производится (при  ключе
       --qq) или пользователю выдается соответствующее сообще-
       ние и запрос о необходимости записи (если ключ --qq  не
       задан). Время записи можно резко сократить если отка-
       заться от контроля версий на совпадение  (этот  режим
       задается с помощью ключа --ff).

       При попытке записать версию команда ccii требует ввести
       краткий  комментарий,  который  должен  отражать суть
       внесенных изменений  и  заканчиваться  либо  отдельно
       стоящей  `..'  либо  кодом  CCTTRRLL//DD.  Если записываются
       несколько файлов, ccii запрашивает  о  целесообразности
       использования  предыдущего  комментария.  Когда стан-
       дартный файл ввода читается не  с  терминала,  ccii  не
       выдает запроса на ввод комментария, а использует име-
       ющийся для всех файлов (см. ключ --mm).

       Номер записываемой версии может задаваться  любым  из
       следующих  ключей:  --rr,  --ff,  --kk, --ll, --uu, или --qq (см.
       --rr).

       Если архивный файл не существует, ccii  создает  его  и
       начальной  версией  делает рабочий файл (по умолчанию
       ему присваивается номер 1.1), при этом заводится пус-
       той  список  доступа.   Вместо комментария ccii требует
       ввести пояснительный текст (см. --tt).

       Далее приводится полный список ключей с пояснениями.

       --rr[_r_e_v]   Присвоить  записанной  версии  файла  номер
                 _r_e_v,  снять  блокировку, уничтожить рабочий
                 файл (эти действия  проводятся  по  умолча-
                 нию).  При чтении версии из архивного файла
                 (см. _c_o (1)), пользователь  может  сообщить
                 системе,  что предполагается создание новой
                 версии. В этом случае  система  резервирует
                 очередной  номер  за  данным пользователем.
                 Если при записи _r_e_v не задан, версии  прис-
                 ваивается    последний    зарезервированный
                 номер.  Если пользователь открыл для  моди-
                 фикации версию какой-либо ветви дерева вер-
                 сий, при записи произойдет  создание  новой
                 версии  данной ветви. При этом версии прис-
                 воится номер,  на  единицу  больший  самого
                 старшего  номера  версии  этой  ветви.   По
                 умолчанию все компоненты  номера  начальной
                 версии  устанавливаются  равными  1.   Если
                 пользователь  не  проводил  резервирования,
                 является  хозяином  файла  и не задан режим
                 блокировки (ssttrriicctt), то версия  добавляется
                 к  основному  стволу  дерева.  Номер версии
                 (_r_e_v)  должен  либо  быть   больше   самого


                            -2-                     ДЕМОС/PV


CI(1)                  ДЕМОС. Команды                  CI(1)


                 старшего из имеющихся номеров версий данной
                 ветви, либо начинать новую ветвь.  Если _r_e_v
                 -  номер  ветви (а не версии), то к ветви с
                 этим  номером  добавляется   новая   версия
                 файла.  Номер уровня получается увеличением
                 номера старшей версии этой ветви. Если  _r_e_v
                 соответствует   несуществующей  ветви,  эта
                 ветвь создается и в нее заносится начальная
                 версия  с  номером  _r_e_v.1.  К стволу дерева
                 версии могут добавляться только к концу, но
                 не заноситься в середину.

       --ff[_r_e_v]   Принудительная запись. Новая версия записы-
                 вается даже в том случае, если она не отли-
                 чается от предыдущей.

       --kk[_r_e_v]   Поиск в рабочем файле ключевого  слова  для
                 определения  номера  версии, даты создания,
                 автора и текущего состояния (см. _c_o (1))  и
                 присвоение  этих  значений сохраняемой вер-
                 сии.   Номер  версии,  задаваемый   ключем,
                 переопределяет  номер  версии,  указанный в
                 рабочем  файле.   Этот  режим  полезен  при
                 записи  полученных "со стороны" программных
                 компонент, когда версия должна  быть  запи-
                 сана  с  сохранением  оригинального номера,
                 даты, автора и состояния.

       --ll[_r_e_v]   Выполняет  функции,  аналогичные   функциям
                 ключа  --rr, но для сохраняемой версии допол-
                 нительно исполняется команда  ccoo  с  ключом
                 --ll;  т.е. записанная версия немедленно изв-
                 лекается и номер очередной версии  резерви-
                 руется  за  тем  же  пользователем.   Режим
                 используется для записи промежуточных  вер-
                 сий при непрерывном редактировании.

       --uu[_r_e_v]   Выполняет действия аналогичные ключу --ll, но
                 номер  очередной  версии  не резервируется.
                 Режим удобен в  случае,  если  сразу  после
                 записи предполагается использовать получен-
                 ную версию.

       --qq[_r_e_v]   Неинтерактивный   режим.    Диагностических
                 сообщений не выдается.  Версия, не отличаю-
                 щаяся от  предыдущей,  не  перезаписывается
                 (если одновременно не задан ключ --ff).

       --mm_m_s_g     Использует строку _m_s_g в качестве  коммента-
                 рия для всех заносимых версий.

       --nn_n_a_m_e    Присваивает символьное имя  _n_a_m_e  заносимой
                 версии.   Если  такое  имя  уже существует,
                 выдается сообщение об ошибке.

       --NN_n_a_m_e    Выполняет действия,  аналогичные  действиям
                 по  ключу  --nn,  но  если  указнное  имя уже
                 существует,  оно  переприсваивается   новой


                            -3-                     ДЕМОС/PV


CI(1)                  ДЕМОС. Команды                  CI(1)


                 версии.

       --ss_s_t_a_t_e   Устанавливает  статус  записываемой  версии
                 _s_t_a_t_e.  По умолчанию версия получает статус
                 EExxpp (экспериментальная).

       --tt[_t_x_t_f_i_l_e]
                 Записывает пояснительный текст  в  архивный
                 файл  RRCCSS  (уничтожая ранее занесенный ком-
                 ментарий). Если _t_x_t_f_i_l_e не указан,  команда
                 ccii  читает пояснительный текст из стандарт-
                 ного  файла  ввода.  Вводимый   комментарий
                 может состоять из нескольких строк и должен
                 завершаться строкой, содержащей  единствен-
                 ный  символ  `..'  или код CCTTRRLL//DD. Если файл
                 _t_x_t_f_i_l_e задан, пояснительный текст  копиру-
                 ется  из него.  При инициализации архивного
                 файла ввод пояснительного  текста  произво-
                 дится  в  любом  случае, вне зависимости от
                 того, был ли задан ключ --tt или нет.  Запрос
                 на  ввод текста не выдается, если стандарт-
                 ный файл ввода читается не с терминала.

ДДИИААГГННООССТТИИККАА
       Команда ccii  выдает  для  каждой  записываемой  версии
       имена  рабочего  и архивного файлов, номер предыдущей
       версии и номер данной версии.

       Код ответа всегда относится к последней  записываемой
       версии:  0 - операция прошла успешно, 1 - в остальных
       случаях.

РРЕЕЖЖИИММЫЫ ДДООССТТУУППАА КК ФФААЙЙЛЛААММ
       Архивный файл,  создаваемый  командой  ccii,  наследует
       режимы  доступа (по чтению и выполнению) от исходного
       рабочего файла.  Если архивный файл  уже  существует,
       при  записи  версий его режимы чтения и выполнения не
       изменяются.  В любом случае команда ccii снимает  флаги
       разрешения записи в архивный файл.

ФФААЙЙЛЛЫЫ
       Пользователь, вызывающий команду записи версии,  дол-
       жен  иметь права чтения и записи в каталоги, содержа-
       щие архивный и рабочие файлы, и право  чтения  архив-
       ного  файла.   В  процессе работы создаются несколько
       временных файлов.  В частности, в каталоге,  содержа-
       щем архивный файл, создается специальный файл-семафор
       для  блокировки  попыток  одновременного   обновления
       архивного файла.  При обновлении архивного файла сис-
       тема выполняет все действия над его копией  и  только
       после получения нового варианта архивного файла прис-
       ваивает ему  соответствующие  имя.   Такая  стратегия
       работы делает попытки связывания архивного файла бес-
       полезными.

ДДООППООЛЛННИИТТЕЕЛЛЬЬННЫЫЕЕ ССССЫЫЛЛККИИ
       _c_o(1),  _i_d_e_n_t(1),  _r_c_s(1),  _r_c_s_d_i_f_f(1),  _r_c_s_i_n_t_r_o(1),
       _r_c_s_m_e_r_g_e(1), _r_l_o_g(1), _r_c_s_f_i_l_e(5)


                            -4-                     ДЕМОС/PV

