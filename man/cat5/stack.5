
STACK(5)           ДЕМОС. Форматы данных            STACK(5)


ИИММЯЯ
        ssttaacckk -  соглашения о связях языка Си на СМ ЭВМ.

ООППИИССААННИИЕЕ
        Есть два стандартных  соглашения  о  связях  функций
        языка  Си.   Вид  стека  для  программ на языках C и
        Фортран-77:

                ------------------
                | n-ный аргумент |        аргументы
                ------------------
                | .............. |
                ------------------
                |второй аргумент |
                ------------------
                |первый аргумент |
                ------------------        jjssrr ppcc,*$__f_o_o
                | адрес возврата |
                ------------------        jjssrr rr55,ccssvv
                |старое знач. R5 |<------
                ------------------      |
                |   номер пред.  |      |
                |    оверлея     |      |
                ------------------      |
                |       r4       |      |
                ------------------      |
                |       r3       |      |
                ------------------      |
                |       r2       |      |
                ------------------      |
                |1-ая auto перем.|      | Это вершина стека
                |                |      | в момент начала
                |                |      | работы вызываемой
                ------------------      | функции
                |    временная   |      |
                |      память    |      |
                |     функции    |      | ssuubb $_n,sspp
                ------------------      |
                | аргументы еще  |      |
                | одного вызова  |      |
                ------------------      | jjssrr ppcc,*$__b_a_r
                | адрес возврата |      |
                ------------------      | jjssrr rr55,ccssvv
                |   старый R5 ---+-------
                ------------------      ^
                |   номер пред.  |      |
                |    оверлея     |      |
                ------------------      |
                | r4/r3/r2/...   |      |
                ------------------
                | и так далее... |

        Возврат целых значений осуществляется через  регистр
        rr00,  или  через  пару  регистров (rr00,rr11) для длинных
        целых;  возврат  действительных   значений -   через
        регистр   ffrr00.    Функции,  возвращающие  структуры,
        оставляют адрес статической области памяти, в  кото-
        рой  находится  возвращаемая  структура,  в  rr00 (для


                            -1-                      ДЕМОС/P


STACK(5)           ДЕМОС. Форматы данных            STACK(5)


        каждой такой функции статически отводится  по  одной
        области), и вызывающая функция копирует возвращаемую
        структуру в нужное место.

        Обращение к автоматическим переменным  выглядит  как
        ``-_N(rr55)'',   к  аргументам  обращаются  ``+_N(rr55)''.
        Аргументы начинаются с 4(rr55), первая целая автомати-
        ческая переменная находится по адресу -10(rr55).  Ука-
        затель стека (sspp) в  начале  работы  функции  всегда
        указывает  на следующее свободное слово стека.  Если
        у функции нет автоматических переменных,  и  она  не
        вызывает  другие функции, указатель стека не изменя-
        ется, и ячейка ``_1-_а_я _а_в_т_о_м_а_т_и_ч_е_с_к_а_я _п_е_р_е_м_е_н_н_а_я'' не
        используется.

        Важный момент: функции знают, сколько аргументов они
        передают  другим функциям, так что они могут восста-
        навливать стек после возврата.  Для вызываемой функ-
        ции  не  существует стандартного способа определения
        числа полученных аргументов.

ЗЗААММЕЕЧЧААННИИЕЕ
        Для  программ  на  Си  и  Фортране-77  рекомендуется
        использование  следующей последовательности сохране-
        ния регистров:

                jjssrr rr00,ccssvv

        Структура стека после вызова ccssvv совпадает с описан-
        ной.






























                            -2-                      ДЕМОС/P

